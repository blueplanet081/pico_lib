<a id="document_top"></a>

# e_module モジュール説明書　 <!-- omit in toc -->

Raspberry Pi Pico W / Pico2 W 上でシングルスレッドのマルチタスクを実現するための基本モジュールです。

<br>

## 対応機種とファームウェアバージョン <!-- omit in toc -->

- Raspberry Pi Pico W
  - ファームウェアバージョン： RPI_PICO_W-20241025-v1.24.0.uf2　以降
  - 上記以前のファームウェアでの動作は未確認です。

- Raspberry Pi Pico2 W
  - ファームウェアバージョン： RPI_PICO2_W-20250415-v1.25.0-preview.542.g9f3062799.uf2 以降
  - 上記以前のファームウェアでの動作は未確認です。

- Raspberry Pi Pico / Pico2
  - 動作する可能性は高いですが、試験は行っていません。

<br>

## ファイル一覧 <!-- omit in toc -->

| ファイル名  | ver.   | 日付       | 内容                 |
| ----------- | ------ | ---------- | -------------------- |
| e_module.py | 作成中 | 2025/05/02 | モジュール本体       |
| e_module.md | 作成中 | 2025/05/02 | ドキュメント（本書） |

<br>

## インストール方法 <!-- omit in toc -->

本モジュールのファイルを、Pico / Pico W のルートディレクトリまたは lib ディレクトリ配下に格納してください。

    /
    └── lib
        └── e_module.py

<br>

## 使用方法 <!-- omit in toc -->

本モジュールから必要なクラスを `import` して使用します。

    from e_module import Edas, CheckTime

<br>

[ドキュメント先頭に戻る](#document_top)

<a id="method_list"></a>
## メソッド一覧 <!-- omit in toc -->

- [1. 　class Edas()](#1-class-edas)
  - [1.1. 　loop\_start()　イベントループを開始する（クラスメソッド）](#11-loop_startイベントループを開始するクラスメソッド)
  - [1.2. 　loop\_stop()　イベントループを停止する（クラスメソッド）](#12-loop_stopイベントループを停止するクラスメソッド)
  - [1.3. 　Freezed()　イベントループを一時的に停止する（内部クラス）](#13-freezedイベントループを一時的に停止する内部クラス)
  - [1.4. 　Edas()　タスクを生成する（コンストラクタ）](#14-edasタスクを生成するコンストラクタ)
  - [1.5. 　resume()　タスクを再開する](#15-resumeタスクを再開する)
<br>
<br>

[ドキュメント先頭に戻る](#document_top)

## 1. 　class Edas()

シングルスレッドでマルチタスク処理を行うためのイベントループとタスク管理機能を提供するクラスです。

### 1.1. 　loop_start()　イベントループを開始する（クラスメソッド）

イベントループを開始するクラスメソッドです。

#### 書式： <!-- omit in toc -->

    Edas.loop_start(period=None, tracelevel=0)

#### 引数： <!-- omit in toc -->

| 名前       | 型  | 内容                                                             |
| ---------- | --- | --------------------------------------------------------------- |
| period     | int | タイマーループの間隔をミリ秒単位で指定します。省略時は規定値、または現在の値が使用されます。|
| tracelevel | int | トレース情報出力レベル（デバッグ用）を指定します。省略時は 0（出力しない）です。 |

- トレース情報出力レベルは [付録１ トレース情報出力レベル](e_module.md#appendix01)を参照してください。

<br>

### 1.2. 　loop_stop()　イベントループを停止する（クラスメソッド）

イベントループを停止するクラスメソッドです。

#### 書式： <!-- omit in toc -->

    Edas.loop_stop()

<br>

### 1.3. 　Freezed()　イベントループを一時的に停止する（内部クラス）

イベントループを一時的に停止するためのコンテキストマネージャーです。タスクの状態更新を一時的に停止します。

停止する単位時間 (freezetime) をミリ秒単位で指定します。ブロック内の処理が freezetime 内に終了しない場合、単位時間を一区切りとして停止時間を延長します。単位時間のデフォルトは 5 ミリ秒です。

#### 書式： <!-- omit in toc -->

    with Edas.Freezed(freezetime=5):
        # フリーズ中に行う処理
        処理1
        処理2
        ...

<br>

### 1.4. 　Edas()　タスクを生成する（コンストラクタ）

バックグラウンドで動作するタスクを生成するコンストラクタです。

#### 書式： <!-- omit in toc -->

    <etask> = Edas(gen, name=None, ps=None, previous_task=None, pause=False, terminate_by_sync=False, task_nature=BASIC):

#### 戻り値： <!-- omit in toc -->

生成されたタスクオブジェクト（`<etask>`）を返します。

#### 引数： <!-- omit in toc -->

| 名前              | 型           | 内容                           |
| ----------------- | ------------ | ------------------------------------------------- |
| gen               | ジェネレータ | タスクとして動作するジェネレータオブジェクトです。      |
| name              | str          | タスクに付ける名前の文字列です。省略時は適当な名前が自動的に生成されます。      |
| previous_task     | `<etask>`    | 指定された場合、このタスクは指定されたタスクの終了後に実行されます。            |
| pause             | bool         | False（デフォルト）の場合、生成したタスクを即時開始します。True の場合は resume() メソッドによる開始指示があるまで停止します。 |
| on_cancel         | callable    | タスクがキャンセルされた時に実行する短い処理を指定します。省略時はタスクキャンセル時に何も実行しません。|
| terminate_by_sync | bool         | Truneの場合、タスクの終了時に 'SYNC'を待ちます。False（デフォルト）の場合は即時終了します。 |
| task_nature       | int          | タスクの性質を指定します。省略時は BASIC（通常のタスク）になります。            |

- タスクとして動作させるジェネレータオブジェクト、またはそのソースコードを以下では「タスクジェネレータ」と呼びます。
- 「タスクの性質」の指定方法と意味は [付録３ タスクの性質](e_module.md#appendix03) を参照してください。

<br>

### 1.5. 　resume()　タスクを再開する

開始指示待ちのタスク、または pause() で中断されたタスクを開始/再開します。

#### 書式：  <!-- omit in toc -->

    <etask>.resume()

<br>

